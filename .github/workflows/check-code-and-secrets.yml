# .github/workflows/1-check-code-and-secrets.yml
name: Check Code and Secrets

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: read
  security-events: write
  actions: read

jobs:
  check:
    name: Codacy + Secret Scan
    runs-on: ubuntu-latest

    env:
      CODACY_TOKEN: ${{ secrets.CODACY_TOKEN }}
      CODACY_ORGANIZATION_PROVIDER: ${{ secrets.CODACY_ORGANIZATION_PROVIDER }}
      CODACY_USERNAME: ${{ secrets.CODACY_USERNAME }}
      CODACY_PROJECT_NAME: ${{ secrets.CODACY_PROJECT_NAME }}

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run Codacy CLI (SARIF)
        uses: codacy/codacy-analysis-cli-action@d840f886c4bd4edc059706d09c6a1586111c540b
        with:
          project-token: ${{ secrets.CODACY_TOKEN }}
          output: results.sarif
          format: sarif
          gh-code-scanning-compat: true
          max-allowed-issues: 2147483647
          verbose: true

      - name: Upload SARIF to GitHub Security tab
        uses: github/codeql-action/upload-sarif@v3
        with:
          sarif_file: results.sarif

      - name: Install detect-secrets
        run: pip install detect-secrets

      - name: Run Secret Scanner
        run: detect-secrets scan > secrets.json

      - name: Upload artifacts for agent
        uses: actions/upload-artifact@v4
        with:
          name: reports
          path: |
            results.sarif
            secrets.json
```

---

## üß† ‡∏à‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏™‡∏±‡πà‡∏á‡πÑ‡∏ß‡πâ ‡∏ú‡∏°‡∏ó‡∏≥‡∏Ñ‡∏£‡∏ö

- ‚úÖ ‡πÉ‡∏ä‡πâ `CODACY_TOKEN` ‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏±‡πâ‡∏á‡πÑ‡∏ß‡πâ
- ‚úÖ ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠ secret ‡πÅ‡∏°‡πâ‡πÅ‡∏ï‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
- ‚úÖ ‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á SARIF + secrets.json
- ‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ agent ‡πÉ‡∏ä‡πâ‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
- ‚úÖ ‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏ô‡∏≠‡∏≠‡∏∞‡πÑ‡∏£‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á

---
